const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/upg-modal-close-DfXHJzS2.js","assets/index-B0RY7NYi.js","assets/index-CDrq-qvZ.css"])))=>i.map(i=>d[i]);
import{d as it,u as lt,r as B,w as st,n as rt,c as X,o as x,h as dt,_ as et,a as nt,b as ut,e as E,f as d,g as ct,i as _,j as vt,k as ft,t as y,l as _t,m as ot,p as j,q as kt,s as mt,v as gt,x as pt,y as ht,z as q,M as yt,A as U,F as at,B as bt,C as wt,D as xt}from"./index-B0RY7NYi.js";const Tt="/assets/gift-BOWXonxt.png",W={};function Ct(m){return m.getIsPending!==void 0}function $t(m){if(Ct(m))return m;let n=!0,r=m.then(s=>(n=!1,s),s=>{throw n=!1,s});return r.getIsPending=function(){return n},r}function Bt(m){let n={};const r=m.attributes;if(!r)return n;for(let s=r.length-1;s>=0;s--)n[r[s].name]=r[s].value;return n}function St(m){return Object.keys(m).reduce((n,r)=>(m[r]!==!1&&m[r]!==null&&m[r]!==void 0&&(n[r]=m[r]),n),{})}function It(m,n){const{class:r,style:s,...g}=Bt(m),{class:o,style:h,...T}=St(n);return{class:[r,o],style:[s,h],...g,...T}}const Lt=it({inheritAttrs:!1,__name:"InlineSvg",props:{src:{},title:{default:void 0},transformSource:{type:Function,default:m=>m},keepDuringLoading:{type:Boolean,default:!0},uniqueIds:{type:[Boolean,String],default:!1},uniqueIdsBase:{default:""}},emits:["loaded","unloaded","error"],setup(m,{expose:n,emit:r}){const s=m,g=r,o=lt(),h=B(),T=B(),A=B(),O=Math.random().toString(36).substring(2);n({svgElSource:h,request:A}),st(()=>s.src,i=>{I(i)}),I(s.src);function z(i){if(i=i.cloneNode(!0),s.uniqueIds){const p=typeof s.uniqueIds=="string"?s.uniqueIds:O;i=F(i,p,s.uniqueIdsBase)}return i=s.transformSource(i),s.title&&D(i,s.title),i.innerHTML}function I(i){W[i]||(W[i]=S(i)),h.value&&W[i].getIsPending()&&!s.keepDuringLoading&&(h.value=null,g("unloaded")),W[i].then(p=>{h.value=p,rt(()=>{g("loaded",T.value)})}).catch(p=>{h.value&&(h.value=void 0,g("unloaded")),delete W[i],g("error",p)})}function S(i){return $t(new Promise((p,$)=>{const b=new XMLHttpRequest;b.open("GET",i,!0),A.value=b,b.onload=()=>{if(b.status>=200&&b.status<400)try{let L=new DOMParser().parseFromString(b.responseText,"text/xml").getElementsByTagName("svg")[0];L?p(L):$(new Error('Loaded file is not valid SVG"'))}catch(L){$(L)}else $(new Error("Error loading SVG"))},b.onerror=$,b.send()}))}const V=()=>h.value?dt("svg",{...It(h.value,o),innerHTML:z(h.value),ref:T}):null;function D(i,p){const $=i.getElementsByTagName("title");if($.length)$[0].textContent=p;else{const b=document.createElementNS("http://www.w3.org/2000/svg","title");b.textContent=p,i.insertBefore(b,i.firstChild)}}function F(i,p,$=""){const b=["id","href","xlink:href","xlink:role","xlink:arcrole"],L=["href","xlink:href"],w=(N,G)=>L.includes(N)&&(G?!G.includes("#"):!1);return[...i.children].forEach(N=>{var G;if((G=N.attributes)!=null&&G.length){const R=Object.values(N.attributes).map(a=>{const e=/url\((.*?)\)/.exec(a.value);return e!=null&&e[1]&&(a.value=a.value.replace(e[0],`url(${$}${e[1]}_${p})`)),a});b.forEach(a=>{const e=R.find(k=>k.name===a);e&&!w(a,e.value)&&(e.value=`${e.value}_${p}`)})}return N.children.length?F(N,p,$):N}),i}return(i,p)=>(x(),X(V))}}),Mt={class:"modal-mask",name:"modal"},Et={class:"modal-wrapper"},At={class:"modal-container"},Vt={class:"grouping"},Nt={class:"modal-header"},Pt={class:"modal-body"},qt={class:"buttons-group"},Ft={__name:"TaskModal",props:{data:Object},emits:["close"],setup(m,{emit:n}){const r=vt(()=>_t(()=>import("./upg-modal-close-DfXHJzS2.js"),__vite__mapDeps([0,1,2]))),{t:s,locale:g}=nt(),o=m,h=n,{tg:T,user:A}=ut(),O=()=>{h("close")},z=async()=>{var I,S,V,D,F,i,p,$,b,L,w,N,G,R,a,e,k,C,P;if(((S=(I=o.data)==null?void 0:I.task)==null?void 0:S.modal_button_text)==s("modals.task_modal.copy_link")){const M=`https://t.me/tBTCminer_bot?startapp=ref_id${A==null?void 0:A.id}`;navigator.clipboard.writeText(M),h("close",{status:"success",title:s("notification.st_success"),body:s("modals.task_modal.link_copied")})}else if(((D=(V=o.data)==null?void 0:V.task)==null?void 0:D.modal_button_text)==s("modals.task_modal.subscribe"))T==null||T.openTelegramLink((i=(F=o.data)==null?void 0:F.task)==null?void 0:i.n1),h("close");else if((($=(p=o.data)==null?void 0:p.task)==null?void 0:$.modal_button_text)==s("modals.task_modal.go_to_chat"))T==null||T.openTelegramLink((L=(b=o.data)==null?void 0:b.task)==null?void 0:L.n1),h("close");else try{const M=await ot.post("tasks/check_task_completion/",{user_task_id:(w=o.data)==null?void 0:w.id});M.status==200&&(((N=M.data)==null?void 0:N.status)=="Task already claimed"||((G=M.data)==null?void 0:G.status)=="Task claimed")&&h("close",{status:"success",title:s("notification.st_success"),body:s("modals.task_modal.task_completed",{amount:(a=(R=o.data)==null?void 0:R.task)==null?void 0:a.reward_amount,type:(k=(e=o.data)==null?void 0:e.task)==null?void 0:k.reward_type}),task_id:(C=o.data)==null?void 0:C.id})}catch(M){M.status==400&&M.response.data.status=="Task not completed"?h("close",{status:"error",title:s("notification.st_error"),body:s("modals.task_modal.task_not_completed"),task_id:(P=o.data)==null?void 0:P.id}):h("close")}};return(I,S)=>{var V,D,F,i;return x(),E("div",Mt,[d("div",Et,[d("div",At,[d("button",{class:"close",onClick:O},[ct(_(r),{style:{color:"#fff"}})]),d("div",Vt,[d("div",Nt,[ft(I.$slots,"header",{},()=>[j(y(_(s)("modals.task_modal.title")),1)],!0)]),d("div",Pt,y((D=(V=o.data)==null?void 0:V.task)==null?void 0:D[`modal_description${_(g)=="uk"?"":`_${_(g)}`}`]),1),d("div",qt,[d("button",{class:"confirm",onClick:z},y((i=(F=o.data)==null?void 0:F.task)==null?void 0:i[`modal_button_text${_(g)=="uk"?"":`_${_(g)}`}`]),1),d("button",{class:"cancel",onClick:O},y(_(s)("modals.task_modal.cancel")),1)])])])])])}}},Ot=et(Ft,[["__scopeId","data-v-a1346e42"]]),Dt={width:"23",height:"20",viewBox:"0 0 23 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Gt(m,n){return x(),E("svg",Dt,n[0]||(n[0]=[kt('<g filter="url(#filter0_d_2081_2206)"><path d="M9.74377 13.6038C9.60059 13.7478 9.40523 13.8282 9.20231 13.8282C8.99938 13.8282 8.80403 13.7478 8.66085 13.6038L4.33657 9.27883C3.88781 8.83006 3.88781 8.10236 4.33657 7.65444L4.87804 7.11284C5.32694 6.66407 6.0538 6.66407 6.50257 7.11284L9.20231 9.81272L16.4974 2.51748C16.9463 2.06872 17.6739 2.06872 18.1219 2.51748L18.6634 3.05909C19.1122 3.50785 19.1122 4.23541 18.6634 4.68347L9.74377 13.6038Z" fill="#37FF63"></path></g><defs><filter id="filter0_d_2081_2206" x="0" y="0.180908" width="23" height="19.6473" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="2"></feOffset><feGaussianBlur stdDeviation="2"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2081_2206"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2081_2206" result="shape"></feBlend></filter></defs>',2)]))}const Rt={render:Gt},zt={class:"screen-box"},jt={class:"title"},Ht={class:"tasks-scroll-block"},Ut={class:"tasks-navigation"},Wt={key:0,class:"tasks-navigation-item-badge"},Xt={key:0,class:"tasks-navigation-item-badge"},Zt={key:0,class:"tasks-navigation-item-badge"},Jt={key:0,class:"tasks-navigation-item-badge"},Kt={key:0,class:"tasks-navigation-item-badge"},Qt={class:"tasks-banner"},Yt={class:"tasks-banner-text"},ta={class:"tasks-block"},aa={key:0,class:"empty-list"},sa={class:"tasks-block-list"},ea={class:"task-item-icon"},na={class:"task-item-info"},oa={class:"task-item-info-title"},ia={class:"task-item-info-price"},la={key:0,src:wt,width:"16px"},ra={key:1,src:xt,width:"16px"},da=["disabled","onClick"],ua={__name:"TasksView",setup(m){const n=mt(),r=B([]),s=B([]),g=B({}),{t:o,locale:h}=nt();let T=null;const A=B(""),O=B(""),z=B(""),I=B(!1),S=B(null),V=B(0),D=gt(()=>{var a;return S.value!==null?(a=r.value)==null?void 0:a.filter(e=>{var k,C,P,M;return(M=(k=e==null?void 0:e.task)==null?void 0:k.categories)==null?void 0:M.includes((P=(C=s.value)==null?void 0:C.find(H=>(H==null?void 0:H.name)==S.value))==null?void 0:P.id)}):r.value}),F=B(null),i=()=>{F.value.scrollTo({top:0,behavior:"smooth"})};let p=null;async function $(){await n.initTasks().then(a=>{var e;r.value=n==null?void 0:n.tasks,V.value=(e=n==null?void 0:n.tasks)==null?void 0:e.filter(k=>!k.claimed).length}).catch(a=>{console.error(a)}).finally(()=>{p=setTimeout(()=>$(),3e3)})}const b=B(!1),L=B(null),w=B([]),N=async a=>{var e;if(!(a!=null&&a.claimed)){w.value.includes(a.id)||w.value.push(a.id);try{T=new AbortController;const k=await ot.post("tasks/check_task_completion/",{user_task_id:a.id},{signal:T.signal});k.status==200&&((e=k.data)==null?void 0:e.status)=="Task claimed"&&(A.value="success",O.value=o("notification.st_success"),z.value=o("notification.task_completed",{value:`${a.task.reward_amount} ${a.task.reward_type}`}),I.value=!0)}catch(k){if(k.response.data.status=="Task started")g.value[a.id]=(g.value[a.id]||0)+1,L.value=a,b.value=!0;else if(k.response.data.status=="Task not completed")g.value[a.id]=(g.value[a.id]||0)+1,w.value.includes(a.id)&&g.value[a.id]==2&&(w.value=w.value.filter(C=>C!==a.id),delete g.value[a.id],A.value="error",O.value=o("notification.st_error"),z.value=o("notification.task_uncompleted"),I.value=!0),w.value.includes(a.id)&&g.value[a.id]!==2&&(L.value=a,b.value=!0);else if(k.response.data.status=="Task already claimed"){w.value.includes(a.id)&&(w.value=w.value.filter(C=>C!==a.id)),g.value[a.id]&&delete g.value[a.id];return}else A.value="error",O.value=o("notification.st_error"),z.value=k.response.data.status,I.value=!0}finally{T=null}}},G=a=>{L.value=null,b.value=!1,a&&(A.value=a.status,O.value=a.title,z.value=a.body,I.value=!0,a.task_id&&(w.value=w.value.filter(e=>e!==a.task_id),delete g.value[a.task_id]))},R=a=>{i(),S.value=a};return pt(async()=>{var a;try{const[e,k]=await Promise.all([n.initTaskCateg(),n.initTasks(null)]);s.value=n==null?void 0:n.task_categ,r.value=n==null?void 0:n.tasks,V.value=(a=n==null?void 0:n.tasks)==null?void 0:a.filter(C=>!C.claimed).length}catch(e){console.error(e)}finally{$()}}),st(S.value,async(a,e)=>{var k,C;a!==e&&(await n.initTasks(((C=(k=s.value)==null?void 0:k.find(P=>(P==null?void 0:P.name)===a))==null?void 0:C.id)||null),r.value=n==null?void 0:n.tasks)},{immediate:!0}),ht(()=>{T&&T.abort(),p&&(clearTimeout(p),p=null)}),(a,e)=>{var k,C,P,M,H,Z,J,K;return x(),E(at,null,[b.value?(x(),X(Ot,{key:0,data:L.value,onClose:G},null,8,["data"])):q("",!0),I.value?(x(),X(yt,{key:1,status:A.value,title:O.value,body:z.value,onClose:e[0]||(e[0]=t=>I.value=!1)},null,8,["status","title","body"])):q("",!0),d("div",zt,[d("h1",jt,y(_(o)("tasks.title")),1),d("div",Ht,[d("div",Ut,[d("div",{class:U(["tasks-navigation-item",{active:S.value==null}]),onClick:e[1]||(e[1]=t=>R(null))},[V.value?(x(),E("div",Wt,y(V.value),1)):q("",!0),j(" "+y(_(o)("tasks.all_tab")),1)],2),d("div",{class:U(["tasks-navigation-item",{active:S.value=="energizers"}]),onClick:e[2]||(e[2]=t=>R("energizers"))},[(k=r.value)!=null&&k.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="energizers"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length?(x(),E("div",Xt,y((C=r.value)==null?void 0:C.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="energizers"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length),1)):q("",!0),j(" "+y(_(o)("tasks.enr_tab")),1)],2),d("div",{class:U(["tasks-navigation-item",{active:S.value=="special"}]),onClick:e[3]||(e[3]=t=>R("special"))},[(P=r.value)!=null&&P.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="special"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length?(x(),E("div",Zt,y((M=r.value)==null?void 0:M.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="special"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length),1)):q("",!0),j(" "+y(_(o)("tasks.spec_tab")),1)],2),d("div",{class:U(["tasks-navigation-item",{active:S.value=="miners"}]),onClick:e[4]||(e[4]=t=>R("miners"))},[(H=r.value)!=null&&H.map(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="miners"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length?(x(),E("div",Jt,y((Z=r.value)==null?void 0:Z.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="miners"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length),1)):q("",!0),j(" "+y(_(o)("tasks.mine_tab")),1)],2),d("div",{class:U(["tasks-navigation-item",{active:S.value=="new"}]),onClick:e[5]||(e[5]=t=>R("new"))},[(J=r.value)!=null&&J.map(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="new"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length?(x(),E("div",Kt,y((K=r.value)==null?void 0:K.filter(t=>{var f,u,c,v;return((v=(f=t==null?void 0:t.task)==null?void 0:f.categories)==null?void 0:v.includes((c=(u=s.value)==null?void 0:u.find(l=>(l==null?void 0:l.name)=="new"))==null?void 0:c.id))&&!(t!=null&&t.claimed)}).length),1)):q("",!0),j(" "+y(_(o)("tasks.new_tab")),1)],2)])]),d("div",{class:"tasks",ref_key:"scrollView",ref:F},[d("div",Qt,[e[6]||(e[6]=d("img",{src:Tt,width:"102px"},null,-1)),d("div",Yt,[d("h2",null,y(_(o)("tasks.banner_title")),1),d("p",null,y(_(o)("tasks.banner_desc")),1)])]),d("div",ta,[d("h2",null,y(_(o)("tasks.task_list_title")),1),D.value.length?q("",!0):(x(),E("span",aa,y(_(o)("tasks.empty_list")),1)),d("div",sa,[(x(!0),E(at,null,bt(D.value,(t,f)=>{var u,c,v,l,Q,Y,tt;return x(),E("div",{class:"task-item",key:f},[d("div",ea,[(u=t==null?void 0:t.task)!=null&&u.icon?(x(),X(_(Lt),{key:0,src:(c=t==null?void 0:t.task)==null?void 0:c.icon},null,8,["src"])):q("",!0)]),d("div",na,[d("p",oa,y((v=t==null?void 0:t.task)==null?void 0:v[`title${_(h)=="uk"?"":`_${_(h)}`}`]),1),d("span",ia,[j(y((l=t==null?void 0:t.task)==null?void 0:l.reward_amount)+" ",1),((Q=t==null?void 0:t.task)==null?void 0:Q.reward_type)=="kW"?(x(),E("img",la)):q("",!0),((Y=t==null?void 0:t.task)==null?void 0:Y.reward_type)=="tBTC"?(x(),E("img",ra)):q("",!0)])]),d("button",{class:U(["task-item-btn",{pending:w.value.includes(t==null?void 0:t.id)&&!(t!=null&&t.claimed),done:t==null?void 0:t.claimed}]),disabled:t==null?void 0:t.claimed,onClick:ca=>N(t)},[j(y(t!=null&&t.claimed?_(o)("tasks.done"):w.value.includes(t==null?void 0:t.id)?(tt=g.value)!=null&&tt[t.id]?_(o)("tasks.pending"):_(o)("tasks.start"):_(o)("tasks.start"))+" ",1),t!=null&&t.claimed?(x(),X(_(Rt),{key:0})):q("",!0)],10,da)])}),128))])])],512)])],64)}}},fa=et(ua,[["__scopeId","data-v-b44c1ae4"]]);export{fa as default};
