import{_ as ht,s as yt,G as at,a as gt,b as jt,H as Tt,r,w as kt,x as Ct,y as Bt,e as xt,c as lt,z as it,g as Ut,f as e,M as Wt,i as o,I as At,t as i,J as Ft,D as dt,C as ct,K as A,L as rt,N as Mt,O as Nt,F as Vt,P as ut,Q as c,m as pt,R as ft,o as F}from"./index-B0RY7NYi.js";import{W as St}from"./WithdrawModal-viuwLIUb.js";const Dt={class:"title"},Qt={class:"balance"},$t={class:"ton"},It={class:"left-side"},Jt={class:"grouping"},Rt={class:"price"},Ot={class:"current-val"},Pt={class:"tbit"},Et={class:"left-side"},Ht={class:"grouping"},Kt={class:"price"},zt={class:"current-val"},Lt={class:"energy"},Gt={class:"left-side"},Yt={class:"grouping"},Zt={class:"label"},qt={class:"price"},Xt={class:"current-val"},ts={class:"top-up"},ss={class:"switch"},es={class:"topup-form"},os=["placeholder"],ns={class:"user-wallet"},as={class:"grouping"},ls={class:"tbit"},is={class:"left-side"},ds={class:"amount"},cs={class:"energy"},rs={class:"left-side"},us={class:"amount"},ps={__name:"WalletView",setup(fs){const n=yt(),M=at(!1),N=at(),{t:d}=gt(),{networkFee:V,userAddress:S}=jt(),{tonConnectUI:T,setOptions:vs}=Tt(),D=Nt();let _=null;const h=r("kw"),u=r(null),k=r(""),C=r(""),B=r(""),y=r(!1),x=(a,t,f)=>{k.value=a,C.value=t,B.value=f,y.value=!0},Q=r(!1);async function $(a){return await new ft.TonClient({apiKey:"90ff1e63f54f82220c606905fd294f2c0253abf4a16d7bfa159c1c0c48252167",endpoint:"https://toncenter.com/api/v2/jsonRPC"}).open(ft.JettonMaster.create(c.Address.parse(a))).getWalletAddress(c.Address.parse(N.value))}async function vt(a){if(!N.value){x("warning",d("notification.st_attention"),d("notification.unconnected"));return}if(!g.value){g.value=!0,m.value=!0;try{await T.closeModal()}catch{}if(a=="kw")try{const t="EQBhF8jWase_Cn1dNTTe_3KMWQQzDbVw_lUUkvW5k6s61ikb",f="UQA1yfxD2yVTu_1QMycifyLMOhJoY_BiJBktI_dAeFjYHLid",v=await $(t),w=c.beginCell().storeUint(260734629,32).storeUint(0,64).storeCoins(c.toNano(u.value)).storeAddress(c.Address.parse(f)).storeAddress(c.Address.parse(S)).storeUint(0,1).storeCoins(1).storeUint(0,1).endCell(),b={validUntil:Date.now()+1e3*60*5,messages:[{address:v.toString(),amount:c.toNano(V).toString(),payload:w.toBoc().toString("base64")}]},p=await T.sendTransaction(b,{modals:["before","success"],notifications:[]});p&&(p!=null&&p.boc)&&(await pt.post("add-kw-to-wallet/",{kw_amount:u.value}),await n.initUser(),x("success",d("notification.st_success"),d("notification.success_dep",{value:u.value,currency:"kW"})),u.value=null)}catch(t){console.log(t)}finally{g.value=!1,setTimeout(()=>{m.value=!1},1500)}if(a=="tbtc")try{const t="EQBOqBiArR45GUlifxdzZ40ZahdVhjtU7GjY-lVtqruHvQEc",f="UQB0ukWTZXHQhlhztL91277hD8xbFFKXiHVvSBNw-gcBKHfO",v=await $(t),w=c.beginCell().storeUint(260734629,32).storeUint(Date.now(),64).storeCoins(c.toNano(u.value/10**5)).storeAddress(c.Address.parse(f)).storeAddress(c.Address.parse(S)).storeUint(0,1).storeCoins(1).storeUint(0,1).endCell(),b={validUntil:Date.now()+1e3*60*5,messages:[{address:v.toString(),amount:c.toNano(V).toString(),payload:w.toBoc().toString("base64")}]},p=await T.sendTransaction(b,{modals:["before","success"],notifications:[]});p&&p.boc&&(await pt.post("add-tbtc-to-wallet/",{tbtc_amount:u.value}),await n.initUser(),x("success",d("notification.st_success"),d("notification.success_dep",{value:u.value,currency:"fBTC"})),u.value=null)}catch(t){console.log(t)}finally{g.value=!1,setTimeout(()=>{m.value=!1},1500)}}}const _t=a=>{Q.value=!1,k.value=a.status,C.value=a.title,B.value=a.body,y.value=!0},m=r(!1),g=r(!1),U=r(!1),mt=a=>new Promise(t=>setTimeout(t,a));let j=null;async function W(){if(m.value){U.value=!0;return}n.setPauseUpdate(!0);try{await n.initUser(),_=new AbortController,await ut.get(`accounts/${M.value}`,{signal:_.signal}).then(a=>{var t;a.status==200&&n.setTonBalance((t=a==null?void 0:a.data)==null?void 0:t.balance)}).finally(()=>{_=null}),await mt(2e3),await ut.get(`accounts/${M.value}/jettons`).then(a=>{var t;a.status==200&&n.setJettons((t=a==null?void 0:a.data)==null?void 0:t.balances)})}catch(a){console.log(a)}finally{_=null,j=setTimeout(()=>W(),5e3)}}function wt(){n.setPauseUpdate(!1)}kt(m,()=>{m.value==!1&&U.value==!0&&(U.value=!1,W())},{immediate:!0});const I=r(),bt=async()=>{I.value.scrollTo({top:550,behavior:"smooth"})};return Ct(()=>{W()}),Bt(()=>{_&&_.abort(),wt(),j&&(clearTimeout(j),j=null)}),(a,t)=>{var f,v,w,b,p,J,R,O,P,E,H,K,z,L,G,Y,Z,q,X,tt,st,et,ot,nt;return F(),xt(Vt,null,[y.value?(F(),lt(Wt,{key:0,status:k.value,title:C.value,body:B.value,onClose:t[0]||(t[0]=s=>y.value=!1)},null,8,["status","title","body"])):it("",!0),Q.value?(F(),lt(St,{key:1,onClose:_t})):it("",!0),Ut(o(At)),e("div",{class:"screen-box",ref_key:"screenBoxRef",ref:I},[e("h1",Dt,i(o(d)("wallet.title")),1),e("div",Qt,[e("div",$t,[e("div",It,[t[8]||(t[8]=e("img",{src:Ft,width:"35px",height:"35px"},null,-1)),e("div",Jt,[t[7]||(t[7]=e("h2",{class:"label"},"Toncoin",-1)),e("span",Rt,i(((f=o(n))==null?void 0:f.tonBalance)/10**9)+" TON",1)])]),e("span",Ot,i(+(+(((v=o(n))==null?void 0:v.tonBalance)/10**9)*+(((w=o(n).prices)==null?void 0:w.TON)||0)).toFixed(2))+" $",1)]),e("div",Pt,[e("div",Et,[t[10]||(t[10]=e("img",{src:dt,width:"35px",height:"35px"},null,-1)),e("div",Ht,[t[9]||(t[9]=e("h2",{class:"label"},"TonBitcoin (Fork)",-1)),e("span",Kt,i((b=o(n).jettons)!=null&&b.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="fBTC"})?((p=o(n).jettons.find(s=>s.jetton.symbol=="fBTC"))==null?void 0:p.balance)/10**((J=o(n).jettons.find(s=>s.jetton.symbol=="fBTC"))==null?void 0:J.jetton.decimals):"0")+" fBTC",1)])]),e("span",zt,i(+(+((R=o(n).jettons)!=null&&R.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="fBTC"})?((O=o(n).jettons.find(s=>s.jetton.symbol=="fBTC"))==null?void 0:O.balance)/10**((P=o(n).jettons.find(s=>s.jetton.symbol=="fBTC"))==null?void 0:P.jetton.decimals):"0")*(((E=o(n).prices)==null?void 0:E.FBTC)||+o(n).stonfi_fbtc||0)).toFixed(2))+" $",1)]),e("div",Lt,[e("div",Gt,[t[11]||(t[11]=e("img",{src:ct,width:"35px",height:"35px"},null,-1)),e("div",Yt,[e("h2",Zt,i(o(d)("wallet.energy")),1),e("span",qt,i((H=o(n).jettons)!=null&&H.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"})?+(+((z=(K=o(n).jettons)==null?void 0:K.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"}))==null?void 0:z.balance)/10**((Z=(Y=(G=(L=o(n))==null?void 0:L.jettons)==null?void 0:G.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"}))==null?void 0:Y.jetton)==null?void 0:Z.decimals)).toFixed(4):"0")+" kW",1)])]),e("span",Xt,i(+(+((q=o(n).jettons)!=null&&q.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"})?((tt=(X=o(n).jettons)==null?void 0:X.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"}))==null?void 0:tt.balance)/10**((ot=(et=(st=o(n).jettons)==null?void 0:st.find(s=>{var l;return((l=s==null?void 0:s.jetton)==null?void 0:l.symbol)=="kW"}))==null?void 0:et.jetton)==null?void 0:ot.decimals):"0")*(((nt=o(n).prices)==null?void 0:nt.KW)||+o(n).stonfi_kw||0)).toFixed(2))+" $",1)])]),e("div",ts,[e("h3",null,i(o(d)("wallet.topup_title")),1),e("div",ss,[A(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),label:"kW",type:"radio",id:"kw",name:"currency",value:"kw",checked:""},null,512),[[rt,h.value]]),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>h.value=s),label:"fBTC",type:"radio",id:"tbtc",name:"currency",value:"tbtc"},null,512),[[rt,h.value]])]),e("div",es,[A(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),type:"text",inputmode:"decimal",placeholder:o(d)("wallet.topup_placeholder"),id:"topup-amount",onFocus:bt},null,40,os),[[Mt,u.value]]),e("button",{class:"topup-btn",onClick:t[4]||(t[4]=s=>vt(h.value))},i(o(d)("wallet.topup_btn")),1)])]),e("div",ns,[e("h3",null,i(o(d)("wallet.user_title")),1),e("div",as,[e("div",ls,[e("div",is,[t[12]||(t[12]=e("img",{src:dt,width:"40px",height:"40px"},null,-1)),e("h2",ds,i(+(+o(n).user.tbtc_wallet).toFixed(2)||0)+" fBTC",1)]),e("button",{onClick:t[5]||(t[5]=()=>{o(D).push("/wheel")})},i(o(d)("wallet.spend_btn")),1)]),e("div",cs,[e("div",rs,[t[13]||(t[13]=e("img",{src:ct,width:"40px",height:"40px"},null,-1)),e("h2",us,i(+(+o(n).user.kw_wallet).toFixed(2)||0)+" kW",1)]),e("button",{onClick:t[6]||(t[6]=()=>{o(D).push("/wheel")})},i(o(d)("wallet.spend_btn")),1)])])])],512)],64)}}},ws=ht(ps,[["__scopeId","data-v-8a4466ca"]]);export{ws as default};
